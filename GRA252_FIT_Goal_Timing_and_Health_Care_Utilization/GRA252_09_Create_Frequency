CREATE OR REPLACE TABLE INV_motion.GRA252_Frequency AS

SELECT
 enrolled_id
,steps_date
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 0 THEN 1 END) AS freq00
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 1 THEN 1 END) AS freq01
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 2 THEN 1 END) AS freq02
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 3 THEN 1 END) AS freq03
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 4 THEN 1 END) AS freq04
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 5 THEN 1 END) AS freq05
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 6 THEN 1 END) AS freq06
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 7 THEN 1 END) AS freq07
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 8 THEN 1 END) AS freq08
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 9 THEN 1 END) AS freq09
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 10 THEN 1 END) AS freq10
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 11 THEN 1 END) AS freq11
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 12 THEN 1 END) AS freq12
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 13 THEN 1 END) AS freq13
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 14 THEN 1 END) AS freq14
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 15 THEN 1 END) AS freq15
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 16 THEN 1 END) AS freq16
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 17 THEN 1 END) AS freq17
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 18 THEN 1 END) AS freq18
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 19 THEN 1 END) AS freq19
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 20 THEN 1 END) AS freq20
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 21 THEN 1 END) AS freq21
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 22 THEN 1 END) AS freq22
,COUNT(CASE WHEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) = 23 THEN 1 END) AS freq23

,MIN(CASE WHEN seq = rqd_frqncy_bouts THEN CAST(FORMAT_DATETIME("%H", steps_dt) AS INT64) END) AS frequency_met_hr
,CASE WHEN MAX(seq)>MIN(rqd_frqncy_bouts) THEN MAX(seq) - MIN(rqd_frqncy_bouts) END AS frequency_bouts_over

FROM INV_motion.GRA252_Frequency_List_Bouts
GROUP BY enrolled_id, steps_date
